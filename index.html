<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Ways</title>

    <meta property="og:title" content="Ways">
    <meta property="og:description" content="Acesse o aplicativo Ways.">
    <meta property="og:image" content="https://mesaque-zake.github.io/Ways/icon-512.png">
    <meta property="og:url" content="https://mesaque-zake.github.io/Ways/">
    <meta property="og:type" content="website">

    <link rel="manifest" href="manifest.json">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-title" content="Ways">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <link rel="apple-touch-icon" href="icon-512.png">
    <meta name="theme-color" content="#6105e8">

    <link href="https://fonts.googleapis.com/css2?family=Dancing+Script:wght@700&display=swap" rel="stylesheet">

    <style>
        /* Reseta margens e define a cor base */
        body, html {
            margin: 0; padding: 0; height: 100%; overflow: hidden;
            background-color: #6105e8; /* Fundo Roxo */
            font-family: 'Dancing Script', cursive;
        }

        /* --- Estilos da Tela de Carregamento --- */
        #loading-screen {
            position: absolute; top: 0; left: 0; width: 100%; height: 100%;
            background-color: #6105e8;
            display: flex; flex-direction: column; justify-content: center; align-items: center;
            z-index: 10; /* Fica na frente de tudo */
            transition: opacity 0.5s ease-out; /* Fade out suave quando terminar */
        }

        .pulsing-logo {
            color: white; font-size: 4rem; margin-bottom: 30px;
            animation: pulseLogo 2s infinite ease-in-out;
        }

        /* Container do Caminhão e Barra */
        .loading-progress-container {
            width: 240px; /* Largura da barra */
            text-align: center;
        }

        /* Ícone do Caminhão (SVG) */
        .truck-icon {
            width: 40px; height: auto; fill: white; /* Cor branca */
            margin-bottom: 10px;
            animation: truckBounce 0.8s infinite alternate ease-in-out;
        }

        /* O trilho da barra (fundo mais escuro) */
        .progress-track {
            width: 100%; height: 6px;
            background-color: rgba(255, 255, 255, 0.2); /* Branco transparente */
            border-radius: 10px; overflow: hidden;
        }

        /* O preenchimento da barra (branco sólido) */
        .progress-fill {
            height: 100%; width: 0%; background-color: white; border-radius: 10px;
            /* Animação: cresce rápido até 80%, depois devagar até 95% em 4 segundos */
            animation: fillProgress 4s ease-out forwards;
        }

        /* --- Animações --- */
        @keyframes pulseLogo {
            0%, 100% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.05); opacity: 0.9; }
        }
        @keyframes truckBounce {
            from { transform: translateY(0); }
            to { transform: translateY(-4px); }
        }
        @keyframes fillProgress {
            0% { width: 0%; }
            70% { width: 80%; } /* Chega rápido em 80% */
            100% { width: 95%; } /* Desacelera e para em 95% */
        }

        /* --- Estilo do Iframe do App --- */
        iframe {
            display: block; border: none; height: 100vh; width: 100vw;
            background-color: #6105e8; position: relative; z-index: 1;
            /* O iframe começa invisível, o JS vai mostrar ele quando carregar */
            opacity: 0; transition: opacity 0.5s ease-in;
        }
    </style>
</head>
<body>

    <div id="loading-screen">
        <div class="pulsing-logo">Ways</div>
        
        <div class="loading-progress-container">
            <svg class="truck-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 640 512"><path d="M48 0C21.5 0 0 21.5 0 48V368c0 26.5 21.5 48 48 48H64c0 53 43 96 96 96s96-43 96-96H384c0 53 43 96 96 96s96-43 96-96h32c17.7 0 32-14.3 32-32s-14.3-32-32-32V288 256 237.3c0-17-6.7-33.3-18.7-45.3L512 114.7c-12-12-28.3-18.7-45.3-18.7H416V48c0-26.5-21.5-48-48-48H48zM416 160h50.7L544 237.3V256H416V160zM112 416a48 48 0 1 1 96 0 48 48 0 1 1 -96 0zm368-48a48 48 0 1 1 0 96 48 48 0 1 1 0-96z"/></svg>
            
            <div class="progress-track">
                <div class="progress-fill"></div>
            </div>
        </div>
    </div>
    <iframe id="app-frame" src="https://script.google.com/macros/s/AKfycbz9-TRx-SI_Z1m5bt3uZvpsNGZ3ithe8hsnu6SCcmqwUo9vBH5lQMD3Ih3Fqbp9ud3o/exec"></iframe>

   <script>
        // 1. Registra o Service Worker (Padrão)
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js');
        }

        const iframe = document.getElementById('app-frame');
        const loadingScreen = document.getElementById('loading-screen');
        
        // Variável para controlar o tempo
        let horaQueSaiu = Date.now(); 

        // 2. Quando o Google terminar de carregar pela primeira vez:
        iframe.onload = function() {
            // Mostra o iframe e esconde o carregamento
            iframe.style.opacity = '1';
            loadingScreen.style.opacity = '0';
            setTimeout(() => { loadingScreen.style.display = 'none'; }, 500);
        };

        // 3. O "Despertador Inteligente"
        document.addEventListener("visibilitychange", function() {
            
            // Se o usuário MINIMIZOU ou TROCOU DE ABA
            if (document.visibilityState === "hidden") {
                horaQueSaiu = Date.now(); // Marca a hora exata que saiu
            } 
            
            // Se o usuário VOLTOU
            else if (document.visibilityState === "visible") {
                const horaQueVoltou = Date.now();
                const segundosFora = (horaQueVoltou - horaQueSaiu) / 1000;

                // CONFIGURAÇÃO: Tempo limite em segundos (ex: 600 = 10 minutos)
                // Se ficou fora por MENOS de 10 minutos, não faz nada (mantém onde estava).
                // Se ficou fora por MAIS de 10 minutos, recarrega.
                if (segundosFora > 600) {
                    console.log("Ficou muito tempo fora. Recarregando...");
                    
                    // Mostra a tela de loading de novo
                    loadingScreen.style.display = 'flex';
                    // Pequeno delay para permitir o display:flex aplicar antes da opacidade
                    setTimeout(() => { loadingScreen.style.opacity = '1'; }, 10);
                    
                    iframe.style.opacity = '0';
                    iframe.src = iframe.src; // Força o recarregamento
                } else {
                    console.log("Voltou rápido. Mantendo a sessão.");
                }
            }
        });
    </script>
</body>
</html>
